<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.6.2">Jekyll</generator><link href="https://sujithq.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://sujithq.github.io/" rel="alternate" type="text/html" /><updated>2018-09-16T09:40:57+02:00</updated><id>https://sujithq.github.io/</id><title type="html">Sujith Quintelier’s Blog</title><subtitle>Blog about Azure - .NET - ...</subtitle><entry><title type="html">Setup Blazor development environment</title><link href="https://sujithq.github.io/Setup-Blazor-development-environment" rel="alternate" type="text/html" title="Setup Blazor development environment" /><published>2018-07-12T12:00:00+02:00</published><updated>2018-07-12T12:00:00+02:00</updated><id>https://sujithq.github.io/Setup-Blazor-development-environment</id><content type="html" xml:base="https://sujithq.github.io/Setup-Blazor-development-environment">&lt;p&gt;This guide helps you setting up your &lt;a href=&quot;https://blazor.net/&quot;&gt;Blazor&lt;/a&gt; development environment without messing up your current development machine with beta releases.&lt;/p&gt;

&lt;p&gt;We will use these tools&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.docker.com/community-edition&quot;&gt;Docker Community Edition&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;Visual Studio Code&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Create a local directory with one subdirectory app.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-07-12/create_directory.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;create-dockerfile&quot;&gt;Create Dockerfile&lt;/h1&gt;

&lt;p&gt;First download the latest &lt;a href=&quot;https://hub.docker.com/r/microsoft/dotnet/&quot; title=&quot;dockerfile&quot;&gt;dockerfile&lt;/a&gt; version.
Look at the latest version of &lt;a href=&quot;https://github.com/dotnet/dotnet-docker/blob/master/2.1/sdk/stretch/amd64/Dockerfile&quot;&gt;Linux amd64&lt;/a&gt;. 
Copy the raw content and store it in a file Dockerfile. Modify it by appending ` ` and &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;amp;&amp;amp; dotnet new -i Microsoft.AspNetCore.Blazor.Templates&lt;/code&gt; at the second RUN command.&lt;/p&gt;

&lt;p&gt;It should look like this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;RUN curl &lt;span class=&quot;nt&quot;&gt;-SL&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--output&lt;/span&gt; dotnet.tar.gz https://dotnetcli.blob.core.windows.net/dotnet/Sdk/&lt;span class=&quot;nv&quot;&gt;$DOTNET_SDK_VERSION&lt;/span&gt;/dotnet-sdk-&lt;span class=&quot;nv&quot;&gt;$DOTNET_SDK_VERSION&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-linux-x64&lt;/span&gt;.tar.gz &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dotnet_sha512&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2166986e360f1c3456a33723edb80349e6ede115be04a6331bfbfd0f412494684d174a0cfb21d2feb00d509ce342030160a4b5b445e393ad83bedb613a64bc66'&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sha512sum dotnet.tar.gz &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dotnet_sha512&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; dotnet.tar.gz&quot;&lt;/span&gt; | sha512sum &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; - &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /usr/share/dotnet &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-zxf&lt;/span&gt; dotnet.tar.gz &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; /usr/share/dotnet &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm dotnet.tar.gz &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ln &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; /usr/share/dotnet/dotnet /usr/bin/dotnet &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
	&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; dotnet new &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; Microsoft.AspNetCore.Blazor.Templates
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;create-the-docker-image&quot;&gt;Create the docker image&lt;/h1&gt;
&lt;p&gt;Open a terminal and go to the location of the Dockerfile and run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker build -t blazor:latest .&lt;/code&gt;. This will build the docker image.&lt;/p&gt;

&lt;p&gt;If this fails, just restart your docker and rerun previous command.&lt;/p&gt;

&lt;h2 id=&quot;build&quot;&gt;build&lt;/h2&gt;
&lt;p&gt;This builds the image.&lt;/p&gt;

&lt;h2 id=&quot;-t&quot;&gt;-t&lt;/h2&gt;
&lt;p&gt;This adds a label &lt;code class=&quot;highlighter-rouge&quot;&gt;latest&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;verify&quot;&gt;verify&lt;/h2&gt;
&lt;p&gt;The creation of the image can be verified by &lt;code class=&quot;highlighter-rouge&quot;&gt;docker images&lt;/code&gt;
You should see 2 images. Base image and the one you just created.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-07-12/docker_images.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;start-a-container-instance&quot;&gt;Start a container instance&lt;/h1&gt;
&lt;p&gt;At the prompt run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker run -it --rm --name blazortest -p 8000:80 -v H:\Euricom\Blazor\app\:/app  -w=&quot;/app&quot; blazor:latest&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;run&quot;&gt;run&lt;/h2&gt;
&lt;p&gt;This runs the container:&lt;/p&gt;

&lt;h2 id=&quot;-it&quot;&gt;-it&lt;/h2&gt;
&lt;p&gt;This runs an interactive container.&lt;/p&gt;

&lt;h2 id=&quot;rm&quot;&gt;–rm&lt;/h2&gt;
&lt;p&gt;This removes the container after stopping the container.&lt;/p&gt;

&lt;h2 id=&quot;-p&quot;&gt;-p&lt;/h2&gt;
&lt;p&gt;This maps the internal port (80) to an external port (8000).&lt;/p&gt;

&lt;h2 id=&quot;-v&quot;&gt;-v&lt;/h2&gt;
&lt;p&gt;This maps a local path &lt;code class=&quot;highlighter-rouge&quot;&gt;H:\Euricom\Blazor\app\&lt;/code&gt; to this volume &lt;code class=&quot;highlighter-rouge&quot;&gt;/app&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;-w&quot;&gt;-w&lt;/h2&gt;
&lt;p&gt;This sets the working directory to &lt;code class=&quot;highlighter-rouge&quot;&gt;/app&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;verify-1&quot;&gt;verify&lt;/h2&gt;
&lt;p&gt;In another terminal you should see named instance blazortest&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-07-12/docker_running_instances.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;create-a-new-blazor-project&quot;&gt;Create a new blazor project&lt;/h1&gt;
&lt;p&gt;You can create a new Blazor project the volume created earlier by running this command &lt;code class=&quot;highlighter-rouge&quot;&gt;dotnet new blazor&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Open the project file app.csproj and add this node &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;Watch Include=&quot;**\*.cshtml&quot; /&amp;gt;&lt;/code&gt;. This makes it possible to make changes on the fly.&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;Project&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Sdk=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.NET.Sdk.Web&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;PropertyGroup&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;TargetFramework&amp;gt;&lt;/span&gt;netstandard2.0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/TargetFramework&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;RunCommand&amp;gt;&lt;/span&gt;dotnet&lt;span class=&quot;nt&quot;&gt;&amp;lt;/RunCommand&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;RunArguments&amp;gt;&lt;/span&gt;blazor serve&lt;span class=&quot;nt&quot;&gt;&amp;lt;/RunArguments&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;LangVersion&amp;gt;&lt;/span&gt;7.3&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LangVersion&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/PropertyGroup&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;ItemGroup&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;PackageReference&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Include=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.AspNetCore.Blazor.Browser&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Version=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0.4.0&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;PackageReference&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Include=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.AspNetCore.Blazor.Build&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Version=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0.4.0&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;DotNetCliToolReference&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Include=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Microsoft.AspNetCore.Blazor.Cli&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Version=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;0.4.0&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Watch&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;Include=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;**\*.cshtml&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/ItemGroup&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Project&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;start-the-application&quot;&gt;Start the application&lt;/h1&gt;
&lt;p&gt;Start the application via &lt;code class=&quot;highlighter-rouge&quot;&gt;dotnet watch run&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-07-12/dotnet_watch_run.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;launch-the-application&quot;&gt;Launch the application&lt;/h1&gt;
&lt;p&gt;Open a browser and launch &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:8000&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-07-12/launch_chrome.png&quot; alt=&quot;&quot; title=&quot;Chrome&quot; /&gt;
&lt;img src=&quot;assets/images/2018-07-12/launch_edge.png&quot; alt=&quot;&quot; title=&quot;Edge&quot; /&gt;
&lt;img src=&quot;assets/images/2018-07-12/launch_ff.png&quot; alt=&quot;&quot; title=&quot;Firefox&quot; /&gt;&lt;/p&gt;</content><author><name>Sujith Quintelier</name></author><category term="blazor" /><category term="docker" /><summary type="html">This guide helps you setting up your Blazor development environment without messing up your current development machine with beta releases.</summary></entry><entry><title type="html">Create, build and deploy Azure Functions with Visual Studio, Teamcity and Octopus Deploy</title><link href="https://sujithq.github.io/create-build-and-deploy-azure-functions-with-visual-studio-teamcity-and-octopus-deploy" rel="alternate" type="text/html" title="Create, build and deploy Azure Functions with Visual Studio, Teamcity and Octopus Deploy" /><published>2018-06-22T12:00:00+02:00</published><updated>2018-06-22T12:00:00+02:00</updated><id>https://sujithq.github.io/create-build-and-deploy-azure-functions-with-visual-studio-teamcity-and-octopus-deploy</id><content type="html" xml:base="https://sujithq.github.io/create-build-and-deploy-azure-functions-with-visual-studio-teamcity-and-octopus-deploy">&lt;p&gt;Following this note you will be able to Create, Build and Deploy a simple Azure Function App. You create it in Visual Studio. Let it build with Teamcity and deploy it with Octopus Deploy. The needed Azure Resources will also be deployed.&lt;/p&gt;

&lt;h1 id=&quot;setup&quot;&gt;Setup&lt;/h1&gt;
&lt;h2 id=&quot;tools&quot;&gt;Tools&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Visual Studio 2017 v15.7.4 (VS).&lt;/li&gt;
  &lt;li&gt;TeamCity v2017.2.4 (TC).&lt;/li&gt;
  &lt;li&gt;Octopus Deploy v2018.6.2 (OD).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For this purpose I deployed a Azure VM using this [template] (https://portal.azure.com/#create/octopus.octopusdeployoctopus-deploy), installed an OD Tentacle, a TC Agent and OD cli (in &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Programs\Octo&lt;/code&gt;). OD downloads can be found [here] (https://octopus.com/downloads). Also install the correct .NET version via this [link] (https://www.microsoft.com/web/downloads/platform.aspx) and set the DOTNET_HOME environment variable in TC to &lt;code class=&quot;highlighter-rouge&quot;&gt;C:\Program Files\dotnet\&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Make sure you have installed the Azure development workload in VS. Check via TOOLS\Get Tools and Features…
&lt;img src=&quot;assets/images/2018-06-22/ZuinKne.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;On Workloads tab check Azure development&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-06-22/oojIgPk.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;create&quot;&gt;Create&lt;/h1&gt;
&lt;p&gt;We use VS for developing the Function. Store the project in a source control system supported by TC.&lt;/p&gt;

&lt;h2 id=&quot;function&quot;&gt;Function&lt;/h2&gt;
&lt;p&gt;Add new Project, search for Azure Functions and give it a name. It is a basic http trigger. Nothing fancy. Modify if needed.&lt;/p&gt;

&lt;p&gt;Install Nuget package &lt;code class=&quot;highlighter-rouge&quot;&gt;Microsoft.NET.Sdk.Functions&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;arm-template&quot;&gt;ARM Template&lt;/h2&gt;
&lt;p&gt;Deploying an Azure Function needs 3 Azure Resources:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Storage Account (Microsoft.Storage/storageAccounts)&lt;/li&gt;
  &lt;li&gt;Hosting Plan (Microsoft.We&lt;span&gt;b/serverfarms)&lt;/span&gt;&lt;/li&gt;
  &lt;li&gt;Function App (Microsoft.We&lt;span&gt;b/sites)&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Below you will find a basic ARM Template with these 3 resources and a parameters Template. Set Copy to Output Directory to &lt;code class=&quot;highlighter-rouge&quot;&gt;Copy if Newer&lt;/code&gt;. Add those templates to your project and name them azuredeploy.json and azuredeploy.parameters.json.&lt;/p&gt;

&lt;p&gt;The project structure should look like&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;assets/images/2018-06-22/2yV3WSe.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;template&quot;&gt;Template&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
  &quot;$schema&quot;: &quot;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&quot;,
  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
  &quot;parameters&quot;: {
    &quot;appName&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;metadata&quot;: {
        &quot;description&quot;: &quot;The name of the function app that you wish to create.&quot;
      }
    },
    &quot;sku&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;allowedValues&quot;: [
        &quot;Free&quot;,
        &quot;Shared&quot;,
        &quot;Basic&quot;,
        &quot;Standard&quot;
      ],
      &quot;defaultValue&quot;: &quot;Standard&quot;,
      &quot;metadata&quot;: {
        &quot;description&quot;: &quot;The pricing tier for the hosting plan.&quot;
      }
    },
    &quot;workerSize&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;allowedValues&quot;: [
        &quot;0&quot;,
        &quot;1&quot;,
        &quot;2&quot;
      ],
      &quot;defaultValue&quot;: &quot;0&quot;,
      &quot;metadata&quot;: {
        &quot;description&quot;: &quot;The instance size of the hosting plan (small, medium, or large).&quot;
      }
    },
    &quot;storageAccountType&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;defaultValue&quot;: &quot;Standard_LRS&quot;,
      &quot;allowedValues&quot;: [
        &quot;Standard_LRS&quot;,
        &quot;Standard_GRS&quot;,
        &quot;Standard_RAGRS&quot;
      ],
      &quot;metadata&quot;: {
        &quot;description&quot;: &quot;Storage Account type&quot;
      }
    },
    &quot;location&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;defaultValue&quot;: &quot;[resourceGroup().location]&quot;,
      &quot;metadata&quot;: {
        &quot;description&quot;: &quot;Location for all resources.&quot;
      }
    }
  },
  &quot;variables&quot;: {
    &quot;functionAppName&quot;: &quot;[parameters('appName')]&quot;,
    &quot;hostingPlanName&quot;: &quot;[parameters('appName')]&quot;,
    &quot;storageAccountName&quot;: &quot;[concat(uniquestring(resourceGroup().id), 'functions')]&quot;
  },
  &quot;resources&quot;: [
    {
      &quot;type&quot;: &quot;Microsoft.Storage/storageAccounts&quot;,
      &quot;name&quot;: &quot;[variables('storageAccountName')]&quot;,
      &quot;apiVersion&quot;: &quot;2016-12-01&quot;,
      &quot;location&quot;: &quot;[parameters('location')]&quot;,
      &quot;kind&quot;: &quot;Storage&quot;,
      &quot;sku&quot;: {
        &quot;name&quot;: &quot;[parameters('storageAccountType')]&quot;
      }
    },
    {
      &quot;type&quot;: &quot;Microsoft.Web/serverfarms&quot;,
      &quot;apiVersion&quot;: &quot;2015-04-01&quot;,
      &quot;name&quot;: &quot;[variables('hostingPlanName')]&quot;,
      &quot;location&quot;: &quot;[parameters('location')]&quot;,
      &quot;properties&quot;: {
        &quot;name&quot;: &quot;[variables('hostingPlanName')]&quot;,
        &quot;sku&quot;: &quot;[parameters('sku')]&quot;,
        &quot;workerSize&quot;: &quot;[parameters('workerSize')]&quot;,
        &quot;hostingEnvironment&quot;: &quot;&quot;,
        &quot;numberOfWorkers&quot;: 1
      }
    },
    {
      &quot;apiVersion&quot;: &quot;2015-04-01&quot;,
      &quot;type&quot;: &quot;Microsoft.Web/sites&quot;,
      &quot;name&quot;: &quot;[variables('functionAppName')]&quot;,
      &quot;location&quot;: &quot;[parameters('location')]&quot;,
      &quot;kind&quot;: &quot;functionapp&quot;,
      &quot;properties&quot;: {
        &quot;name&quot;: &quot;[variables('functionAppName')]&quot;,
        &quot;serverFarmId&quot;: &quot;[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]&quot;,
        &quot;hostingEnvironment&quot;: &quot;&quot;,
        &quot;clientAffinityEnabled&quot;: false,
        &quot;siteConfig&quot;: {
          &quot;alwaysOn&quot;: true
        }
      },
      &quot;dependsOn&quot;: [
        &quot;[resourceId('Microsoft.Web/serverfarms', variables('hostingPlanName'))]&quot;,
        &quot;[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]&quot;
      ],
      &quot;resources&quot;: [
        {
          &quot;apiVersion&quot;: &quot;2016-03-01&quot;,
          &quot;name&quot;: &quot;appsettings&quot;,
          &quot;type&quot;: &quot;config&quot;,
          &quot;dependsOn&quot;: [
            &quot;[resourceId('Microsoft.Web/sites', variables('functionAppName'))]&quot;,
            &quot;[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]&quot;
          ],
          &quot;properties&quot;: {
            &quot;AzureWebJobsStorage&quot;: &quot;[concat('DefaultEndpointsProtocol=https;AccountName=',variables('storageAccountName'),';    AccountKey=',listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName')),     '2015-05-01-preview').key1,';')]&quot;,
            &quot;AzureWebJobsDashboard&quot;: &quot;[concat('DefaultEndpointsProtocol=https;AccountName=',variables('storageAccountName'),';    AccountKey=',listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName')),     '2015-05-01-preview').key1,';')]&quot;,
            &quot;FUNCTIONS_EXTENSION_VERSION&quot;: &quot;~1&quot;
          }
        }
      ]
    }
  ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;parameters&quot;&gt;Parameters&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
  &quot;$schema&quot;: &quot;https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#&quot;,
  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,
  &quot;parameters&quot;: {
    &quot;appName&quot;: {
      &quot;value&quot;: &quot;#{AzureFunctionName}&quot;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;build&quot;&gt;Build&lt;/h1&gt;
&lt;p&gt;In TC Create a new project, add a new Build Configuration with 3 Build Steps.&lt;/p&gt;

&lt;h2 id=&quot;parameters-1&quot;&gt;Parameters&lt;/h2&gt;
&lt;p&gt;These are use in TC in scripts, variable names, …&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;apikey (generated in OD)&lt;/li&gt;
  &lt;li&gt;packageId (&lt;code class=&quot;highlighter-rouge&quot;&gt;tc-od&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;server (url to OD)&lt;/li&gt;
  &lt;li&gt;version (semantic version nr like &lt;code class=&quot;highlighter-rouge&quot;&gt;1.0.%build.number%&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;publish&quot;&gt;publish&lt;/h2&gt;
&lt;p&gt;This runner type is .NET CLI (dotnet). Give a Step name. Choose publish as Command. Select the project. Set Configuration and Output directory to bin\Release\PublishOutput
&lt;img src=&quot;assets/images/2018-06-22/bsGq2cx.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;pack&quot;&gt;pack&lt;/h2&gt;
&lt;p&gt;This runner type is Command Line. Give a Step name. Choose Custom script and enter script below.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cd tc-od\bin\Release\PublishOutput
C:\Programs\Octo\octo pack --id=%packageId% --format=zip --outFolder=../dist --version=%version%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;push&quot;&gt;push&lt;/h2&gt;
&lt;p&gt;This runner type is Command Line. Give a Step name. Choose Custom script and enter script below.&lt;/p&gt;

&lt;p&gt;This pushed the zip file to OD.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-Batchfile&quot;&gt;cd tc-od\bin\Release\dist
C:\Programs\Octo\octo push --server=%server% --apiKey=%apikey% --package=%packageId%.%version%.zip
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&quot;deploy&quot;&gt;Deploy&lt;/h1&gt;
&lt;p&gt;In OD make sure you have setup&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;an Environment&lt;/li&gt;
  &lt;li&gt;a Deployment target(in our case a Azure Web App)&lt;/li&gt;
  &lt;li&gt;a Lifecycle with automatic deploy after release creation&lt;/li&gt;
  &lt;li&gt;an Azure Subscription (this is needed to deploy)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Add a project.&lt;/p&gt;

&lt;p&gt;Under Process add 2 steps:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Deploy Resources&lt;/li&gt;
  &lt;li&gt;Deploy Function&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;deploy-resources&quot;&gt;Deploy Resources&lt;/h2&gt;
&lt;p&gt;In this step we deploy the ARM template.&lt;/p&gt;

&lt;p&gt;Search for &lt;code class=&quot;highlighter-rouge&quot;&gt;resource Group&lt;/code&gt; and select Deploy an Azure resource Group.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Set Step Name&lt;/li&gt;
  &lt;li&gt;Select Execution Plan&lt;/li&gt;
  &lt;li&gt;Select an Azure Account and Resource Group&lt;/li&gt;
  &lt;li&gt;Select File inside a package&lt;/li&gt;
  &lt;li&gt;Select Package&lt;/li&gt;
  &lt;li&gt;Set Paths&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;deploy-function&quot;&gt;Deploy Function&lt;/h2&gt;
&lt;p&gt;In this step we deploy the Function.&lt;/p&gt;

&lt;p&gt;Search for &lt;code class=&quot;highlighter-rouge&quot;&gt;azure web&lt;/code&gt; and select Deploy an Azure Web App.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Set Step Name&lt;/li&gt;
  &lt;li&gt;Select Package&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is it. Happy coding!&lt;/p&gt;

&lt;h1 id=&quot;resources&quot;&gt;Resources&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;https://octopus.com/blog/azure-functions&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Sujith Quintelier</name></author><category term="azure" /><category term="azure-functions" /><category term="visual-studio" /><category term="teamcity" /><category term="octopus-deploy" /><summary type="html">Following this note you will be able to Create, Build and Deploy a simple Azure Function App. You create it in Visual Studio. Let it build with Teamcity and deploy it with Octopus Deploy. The needed Azure Resources will also be deployed.</summary></entry></feed>